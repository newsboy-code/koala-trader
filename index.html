<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Newsboy Koala Trader - ë‰´ìŠ¤ë³´ì´ ì½”ì•Œë¼ íŠ¸ë ˆì´ë”</title>
    <script src="https://unpkg.com/peerjs@1.5.2/dist/peerjs.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 10px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            text-align: center;
            color: #764ba2;
            margin-bottom: 20px;
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* ì—°ê²° íŒ¨ë„ */
        .connection-panel {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .connection-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }

        input[type="text"] {
            flex: 1;
            min-width: 200px;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="text"]:focus {
            outline: none;
            border-color: #764ba2;
            box-shadow: 0 0 0 3px rgba(118, 75, 162, 0.1);
        }

        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }

        button:active {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .status-message {
            padding: 12px;
            border-radius: 8px;
            margin-top: 10px;
            font-weight: 500;
        }

        .status-message.info {
            background: #e3f2fd;
            color: #1976d2;
            border-left: 4px solid #1976d2;
        }

        .status-message.error {
            background: #ffebee;
            color: #c62828;
            border-left: 4px solid #c62828;
        }

        .status-message.success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #2e7d32;
        }

        /* ê²Œì„ ë³´ë“œ */
        .game-board {
            display: none;
        }

        .game-board.active {
            display: block;
        }

        /* ì ìˆ˜íŒ */
        .scoreboard {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 20px;
        }

        .player-score {
            background: white;
            padding: 15px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 3px solid transparent;
            transition: all 0.3s;
        }

        .player-score.active-turn {
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .player-score h3 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 1.2rem;
        }

        .score-display {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }

        .seals-display {
            display: flex;
            gap: 5px;
            font-size: 1.5rem;
        }

        /* í† í° í’€ */
        .token-pool {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .token-pool h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .token-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
        }

        .token-item {
            background: white;
            padding: 10px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .token-emoji {
            font-size: 2rem;
            display: block;
            margin-bottom: 5px;
        }

        .token-count {
            font-weight: bold;
            color: #667eea;
        }

        /* ì¹´ë“œ ì˜ì—­ */
        .card-area {
            background: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .card-area h3 {
            color: #764ba2;
            margin-bottom: 10px;
            font-size: 1.1rem;
        }

        .cards-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            min-height: 80px;
            padding: 10px;
            background: #f5f5f5;
            border-radius: 8px;
        }

        .card {
            width: 60px;
            height: 85px;
            background: white;
            border: 3px solid #667eea;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            user-select: none;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }

        .card.selected {
            border-color: #ffd700;
            background: #fffacd;
            transform: translateY(-10px);
            box-shadow: 0 8px 16px rgba(255, 215, 0, 0.4);
        }

        .card.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .card.disabled:hover {
            transform: none;
        }

        /* ì•¡ì…˜ ë²„íŠ¼ */
        .action-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }

        .action-buttons button {
            flex: 1;
            min-width: 150px;
        }

        .btn-take {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
        }

        .btn-sell {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .btn-exchange {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        /* ê²Œì„ ë¡œê·¸ */
        .game-log {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 12px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 20px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .game-log h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .log-entry {
            padding: 8px;
            margin-bottom: 5px;
            background: white;
            border-radius: 6px;
            border-left: 3px solid #667eea;
            font-size: 0.9rem;
        }

        .log-entry.opponent {
            border-left-color: #f5576c;
        }

        /* ëª¨ë‹¬ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: modalSlideIn 0.3s ease-out;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-content h2 {
            color: #764ba2;
            margin-bottom: 20px;
            font-size: 2rem;
        }

        .modal-content p {
            font-size: 1.2rem;
            margin-bottom: 20px;
            color: #333;
        }

        /* ë°˜ì‘í˜• */
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }

            .card {
                width: 50px;
                height: 70px;
                font-size: 1.5rem;
            }

            .scoreboard {
                grid-template-columns: 1fr;
            }

            .action-buttons button {
                min-width: 120px;
            }
        }

        /* ë± ì¹´ìš´í„° */
        .deck-info {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .deck-info h3 {
            color: #764ba2;
            margin-bottom: 10px;
        }

        .deck-count {
            font-size: 2rem;
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“° Newsboy Koala Trader ğŸ¨</h1>
        
        <!-- P2P ì—°ê²° íŒ¨ë„ -->
        <div class="connection-panel">
            <div class="connection-controls">
                <input type="text" id="roomIdInput" placeholder="ë°© ID ì…ë ¥ (ì°¸ê°€ìš©)">
                <button id="hostBtn">ğŸ  ìƒˆ ê²Œì„ ì‹œì‘ (Host)</button>
                <button id="joinBtn">ğŸšª ê²Œì„ ì°¸ê°€ (Guest)</button>
                <button id="startGameBtn" style="display:none;">ğŸ® ê²Œì„ ì‹œì‘</button>
            </div>
            <div id="statusMessage" class="status-message info">
                ì—°ê²° ëŒ€ê¸° ì¤‘... HostëŠ” "ìƒˆ ê²Œì„ ì‹œì‘", GuestëŠ” ë°© IDë¥¼ ì…ë ¥í•˜ê³  "ê²Œì„ ì°¸ê°€"ë¥¼ ëˆŒëŸ¬ì£¼ì„¸ìš”.
            </div>
        </div>

        <!-- ê²Œì„ ë³´ë“œ -->
        <div class="game-board" id="gameBoard">
            <!-- ì ìˆ˜íŒ -->
            <div class="scoreboard">
                <div class="player-score" id="myScoreCard">
                    <h3 id="myNameDisplay">ë‚˜ (Player 1)</h3>
                    <div class="score-display" id="myScore">0</div>
                    <div>ì¸ì¥ ğŸ†: <span id="mySeals" class="seals-display"></span></div>
                </div>
                <div class="player-score" id="opponentScoreCard">
                    <h3 id="opponentNameDisplay">ìƒëŒ€ (Player 2)</h3>
                    <div class="score-display" id="opponentScore">0</div>
                    <div>ì¸ì¥ ğŸ†: <span id="opponentSeals" class="seals-display"></span></div>
                </div>
            </div>

            <!-- ë± ì •ë³´ -->
            <div class="deck-info">
                <h3>ğŸ“š ë‚¨ì€ ë±</h3>
                <div class="deck-count" id="deckCount">40</div>
            </div>

            <!-- í† í° í’€ -->
            <div class="token-pool">
                <h3>ğŸŸ¡ ìƒí’ˆ í† í° í’€</h3>
                <div class="token-grid" id="tokenPool"></div>
            </div>

            <!-- ìƒëŒ€ ì†íŒ¨ (ë’·ë©´ë§Œ í‘œì‹œ) -->
            <div class="card-area">
                <h3>ğŸ´ ìƒëŒ€ ì†íŒ¨ (ë’·ë©´)</h3>
                <div class="cards-container" id="opponentHand"></div>
            </div>

            <!-- ì‹œì¥ -->
            <div class="card-area">
                <h3>ğŸª ì‹œì¥</h3>
                <div class="cards-container" id="market"></div>
            </div>

            <!-- ë‚´ ì†íŒ¨ -->
            <div class="card-area">
                <h3>âœ‹ ë‚´ ì†íŒ¨</h3>
                <div class="cards-container" id="myHand"></div>
                <div class="action-buttons">
                    <button class="btn-take" id="takeBtn">ğŸ“¥ ê°€ì ¸ì˜¤ê¸°</button>
                    <button class="btn-exchange" id="exchangeBtn">ğŸ”„ êµí™˜í•˜ê¸°</button>
                    <button class="btn-take" id="takeKoalasBtn">ğŸ¨ ì½”ì•Œë¼ ëª°ì´</button>
                    <button class="btn-sell" id="sellBtn">ğŸ’° íŒë§¤í•˜ê¸°</button>
                </div>
            </div>

            <!-- ê²Œì„ ë¡œê·¸ -->
            <div class="game-log">
                <h3>ğŸ“œ ê²Œì„ ë¡œê·¸</h3>
                <div id="logContainer"></div>
            </div>
        </div>

        <!-- ê²°ê³¼ ëª¨ë‹¬ -->
        <div class="modal" id="resultModal">
            <div class="modal-content">
                <h2 id="resultTitle">ğŸ† ë¼ìš´ë“œ ì¢…ë£Œ!</h2>
                <p id="resultText"></p>
                <button id="closeModalBtn">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // =============================================
        // ì „ì—­ ë³€ìˆ˜ ë° ìƒìˆ˜ ì •ì˜
        // =============================================
        
        // ì¹´ë“œ íƒ€ì… ì •ì˜ (ì´ëª¨ì§€ë¡œ í‘œí˜„)
        const CARD_TYPES = {
            KOALA: 'ğŸ¨',      // êµí™˜ìš© ì½”ì•Œë¼
            DIAMOND: 'ğŸ’',    // íŠ¹ì¢… (ê³ ê°€ ìƒí’ˆ)
            GOLD: 'ğŸ’°',       // ê²½ì œ (ê³ ê°€ ìƒí’ˆ)
            SILVER: 'ğŸ¥ˆ',     // ê³µì‹œ (ê³ ê°€ ìƒí’ˆ)
            CLOTH: 'ğŸ§¶',      // ì‚¬íšŒ
            SPICE: 'ğŸŒ¶ï¸',      // ì—°ì˜ˆ
            LEATHER: 'ğŸ‘œ'     // ìƒí™œ
        };

        // ìƒí’ˆë³„ í† í° ê°’ ì„¤ì • (íŒë§¤ ì‹œ ë°›ëŠ” ì ìˆ˜)
        const TOKEN_VALUES = {
            [CARD_TYPES.DIAMOND]: [7, 7, 5, 5, 5],
            [CARD_TYPES.GOLD]: [6, 6, 5, 5, 5],
            [CARD_TYPES.SILVER]: [5, 5, 5, 5, 5],
            [CARD_TYPES.CLOTH]: [5, 3, 3, 2, 2, 1, 1],
            [CARD_TYPES.SPICE]: [5, 3, 3, 2, 2, 1, 1],
            [CARD_TYPES.LEATHER]: [4, 3, 2, 1, 1, 1, 1, 1, 1]
        };

        // ë³´ë„ˆìŠ¤ ì ìˆ˜ (ê°™ì€ ìƒí’ˆì„ ë§ì´ íŒ”ë©´ ì¶”ê°€ ì ìˆ˜)
        const BONUS_POINTS = {
            3: 1,
            4: 2,
            5: 3
        };

        // ê³ ê°€ ìƒí’ˆ ëª©ë¡ (2ì¥ ì´ìƒë§Œ íŒë§¤ ê°€ëŠ¥)
        const LUXURY_GOODS = [CARD_TYPES.DIAMOND, CARD_TYPES.GOLD, CARD_TYPES.SILVER];

        // PeerJS ê´€ë ¨ ë³€ìˆ˜
        let peer = null;              // PeerJS ê°ì²´
        let conn = null;              // P2P ì—°ê²° ê°ì²´
        let isHost = false;           // ë‚´ê°€ Hostì¸ì§€ ì—¬ë¶€
        let myPeerId = '';            // ë‚´ Peer ID
        let opponentPeerId = '';      // ìƒëŒ€ Peer ID

        // ê²Œì„ ìƒíƒœ ê°ì²´ (Hostê°€ ë§ˆìŠ¤í„° ë°ì´í„° ê´€ë¦¬)
        let gameState = {
            deck: [],                 // ë± (ì•„ì§ ë½‘ì§€ ì•Šì€ ì¹´ë“œë“¤)
            market: [],               // ì‹œì¥ì— ë†“ì¸ ì¹´ë“œ (5ì¥)
            players: {
                host: {
                    hand: [],         // Host ì†íŒ¨
                    score: 0,         // Host ì ìˆ˜
                    seals: 0          // Hostê°€ íšë“í•œ ì¸ì¥ ê°œìˆ˜
                },
                guest: {
                    hand: [],         // Guest ì†íŒ¨
                    score: 0,         // Guest ì ìˆ˜
                    seals: 0          // Guestê°€ íšë“í•œ ì¸ì¥ ê°œìˆ˜
                }
            },
            tokens: {},               // ë‚¨ì€ í† í° í’€ (ìƒí’ˆë³„)
            currentTurn: 'host',      // í˜„ì¬ í„´ ('host' ë˜ëŠ” 'guest')
            gameStarted: false,       // ê²Œì„ ì‹œì‘ ì—¬ë¶€
            roundEnded: false         // ë¼ìš´ë“œ ì¢…ë£Œ ì—¬ë¶€
        };

        // UI ì„ íƒ ìƒíƒœ
        let selectedMarketCards = [];  // ì‹œì¥ì—ì„œ ì„ íƒí•œ ì¹´ë“œ ì¸ë±ìŠ¤
        let selectedHandCards = [];    // ì†íŒ¨ì—ì„œ ì„ íƒí•œ ì¹´ë“œ ì¸ë±ìŠ¤

        // DOM ìš”ì†Œ ì°¸ì¡°
        const roomIdInput = document.getElementById('roomIdInput');
        const hostBtn = document.getElementById('hostBtn');
        const joinBtn = document.getElementById('joinBtn');
        const startGameBtn = document.getElementById('startGameBtn');
        const statusMessage = document.getElementById('statusMessage');
        const gameBoard = document.getElementById('gameBoard');
        const takeBtn = document.getElementById('takeBtn');
        const exchangeBtn = document.getElementById('exchangeBtn');
        const takeKoalasBtn = document.getElementById('takeKoalasBtn');
        const sellBtn = document.getElementById('sellBtn');
        const resultModal = document.getElementById('resultModal');
        const closeModalBtn = document.getElementById('closeModalBtn');

        // =============================================
        // P2P ì—°ê²° ê´€ë¦¬ í•¨ìˆ˜
        // =============================================

        /**
         * Hostë¡œ ê²Œì„ ì‹œì‘ (ìƒˆ ë°© ìƒì„±)
         */
        function startAsHost() {
            try {
                // PeerJS ê°ì²´ ìƒì„± (ìë™ìœ¼ë¡œ ê³ ìœ  ID ë¶€ì—¬)
                peer = new Peer();

                peer.on('open', (id) => {
                    isHost = true;
                    myPeerId = id;
                    showStatus(`âœ… Hostë¡œ ì—°ê²°ë¨! ë°© ID: ${id}`, 'success');
                    roomIdInput.value = id;
                    
                    // HostëŠ” ê²Œì„ ì‹œì‘ ë²„íŠ¼ì„ ë³¼ ìˆ˜ ìˆìŒ
                    hostBtn.style.display = 'none';
                    joinBtn.style.display = 'none';
                    startGameBtn.style.display = 'inline-block';
                });

                // Guestê°€ ì ‘ì†í•˜ë©´ ì—°ê²° ìˆ˜ë½
                peer.on('connection', (connection) => {
                    conn = connection;
                    opponentPeerId = connection.peer;
                    setupConnection();
                    showStatus(`âœ… Guestê°€ ì ‘ì†í–ˆìŠµë‹ˆë‹¤! ì´ì œ "ê²Œì„ ì‹œì‘" ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.`, 'success');
                });

                peer.on('error', (err) => {
                    showStatus(`âŒ ì˜¤ë¥˜ ë°œìƒ: ${err.type} - ${err.message}`, 'error');
                    console.error('PeerJS ì˜¤ë¥˜:', err);
                });

            } catch (error) {
                showStatus(`âŒ Host ìƒì„± ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error('Host ìƒì„± ì˜¤ë¥˜:', error);
            }
        }

        /**
         * Guestë¡œ ê²Œì„ ì°¸ê°€ (Hostì˜ ë°© IDë¡œ ì ‘ì†)
         */
        function joinAsGuest() {
            const roomId = roomIdInput.value.trim();
            if (!roomId) {
                showStatus('âŒ ë°© IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”!', 'error');
                return;
            }

            try {
                // PeerJS ê°ì²´ ìƒì„±
                peer = new Peer();

                peer.on('open', (id) => {
                    isHost = false;
                    myPeerId = id;
                    opponentPeerId = roomId;

                    // Hostì—ê²Œ ì—°ê²° ì‹œë„
                    conn = peer.connect(roomId);
                    setupConnection();
                    showStatus(`ğŸ”„ Hostì—ê²Œ ì—°ê²° ì‹œë„ ì¤‘... (Host ID: ${roomId})`, 'info');
                    
                    hostBtn.style.display = 'none';
                    joinBtn.style.display = 'none';
                });

                peer.on('error', (err) => {
                    showStatus(`âŒ ì—°ê²° ì˜¤ë¥˜: ${err.type} - ${err.message}`, 'error');
                    console.error('PeerJS ì˜¤ë¥˜:', err);
                });

            } catch (error) {
                showStatus(`âŒ Guest ì—°ê²° ì‹¤íŒ¨: ${error.message}`, 'error');
                console.error('Guest ì—°ê²° ì˜¤ë¥˜:', error);
            }
        }

        /**
         * P2P ì—°ê²° ì„¤ì • (ë°ì´í„° ìˆ˜ì‹  ë¦¬ìŠ¤ë„ˆ ë“±ë¡)
         */
        function setupConnection() {
            conn.on('open', () => {
                showStatus('âœ… P2P ì—°ê²° ì„±ê³µ! ê²Œì„ ì¤€ë¹„ ì™„ë£Œ.', 'success');
            });

            // ë°ì´í„° ìˆ˜ì‹  í•¸ë“¤ëŸ¬
            conn.on('data', (data) => {
                handleReceivedData(data);
            });

            conn.on('close', () => {
                showStatus('âŒ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.', 'error');
            });

            conn.on('error', (err) => {
                showStatus(`âŒ ì—°ê²° ì˜¤ë¥˜: ${err}`, 'error');
                console.error('Connection ì˜¤ë¥˜:', err);
            });
        }

        /**
         * ìƒëŒ€ë¡œë¶€í„° ë°›ì€ ë°ì´í„° ì²˜ë¦¬
         */
        function handleReceivedData(data) {
            console.log('ìˆ˜ì‹ í•œ ë°ì´í„°:', data);

            if (data.type === 'gameStart') {
                // Hostê°€ ê²Œì„ ì‹œì‘ ì‹ í˜¸ë¥¼ ë³´ëƒ„
                gameState = data.gameState;
                gameState.gameStarted = true;
                startGameBtn.style.display = 'none';
                gameBoard.classList.add('active');
                renderGame();
                addLog('ê²Œì„ì´ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!');
            } else if (data.type === 'action') {
                // Guestì˜ í–‰ë™ì„ Hostê°€ ì²˜ë¦¬í•œ í›„ ì „ì²´ ìƒíƒœë¥¼ ë™ê¸°í™”
                if (isHost) {
                    processGuestAction(data.action);
                }
            } else if (data.type === 'stateSync') {
                // Hostê°€ ë³´ë‚¸ ìµœì‹  ê²Œì„ ìƒíƒœë¡œ ë™ê¸°í™”
                gameState = data.gameState;
                renderGame();
            }
        }

        /**
         * ìƒëŒ€ì—ê²Œ ë°ì´í„° ì „ì†¡
         */
        function sendData(data) {
            if (conn && conn.open) {
                conn.send(data);
            } else {
                showStatus('âŒ ì—°ê²°ì´ ëŠì–´ì ¸ ë°ì´í„°ë¥¼ ì „ì†¡í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.', 'error');
            }
        }

        /**
         * ìƒíƒœ ë©”ì‹œì§€ í‘œì‹œ
         */
        function showStatus(message, type = 'info') {
            statusMessage.textContent = message;
            statusMessage.className = `status-message ${type}`;
        }

        /**
         * ê²Œì„ ë¡œê·¸ ì¶”ê°€
         */
        function addLog(message, isOpponent = false) {
            const logContainer = document.getElementById('logContainer');
            const entry = document.createElement('div');
            entry.className = `log-entry ${isOpponent ? 'opponent' : ''}`;
            entry.textContent = message;
            logContainer.insertBefore(entry, logContainer.firstChild);
            
            // ë¡œê·¸ê°€ ë„ˆë¬´ ë§ìœ¼ë©´ ì˜¤ë˜ëœ ê²ƒ ì œê±°
            if (logContainer.children.length > 20) {
                logContainer.removeChild(logContainer.
